import{j as e,m as c,r as d,A as W,e as re}from"./framer-motion-DexFYn3r.js";import{c as u,s as h,B as y,L as w,S as f,a as ie,b as H,d as ne,u as le}from"./index-o6bm3qdW.js";import{f as Z,e as oe,g as ce}from"./es-DGeWnv4b.js";import{d as de,u as me,a as he,g as ue}from"./pantryService-1OnSk01a.js";import{c as G}from"./react-eoYhWYcX.js";import{C as k,a as L,c as I,b as S,e as pe}from"./card-CGU5HWmE.js";import{g as xe}from"./generationService-C6CJkpBz.js";import{E as $}from"./EmptyState-Cb4z0I15.js";import{C as ge}from"./calendar-clock-BfQncUxL.js";import{A as _}from"./arrow-right-CTmM0twQ.js";import{I as fe}from"./input-DTFkI6V9.js";import{P as ye}from"./plus-DaImIilD.js";import"./userService-CZh88SKG.js";/**
 * @license lucide-react v0.320.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=u("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.320.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=u("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.320.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=u("HeartCrack",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}],["path",{d:"m12 13-1-1 2-2-3-3 2-2",key:"xjdxli"}]]);/**
 * @license lucide-react v0.320.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=u("ImageOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M10.41 10.41a2 2 0 1 1-2.83-2.83",key:"1bzlo9"}],["line",{x1:"13.5",x2:"6",y1:"13.5",y2:"21",key:"1q0aeu"}],["line",{x1:"18",x2:"21",y1:"12",y2:"15",key:"5mozeu"}],["path",{d:"M3.59 3.59A1.99 1.99 0 0 0 3 5v14a2 2 0 0 0 2 2h14c.55 0 1.052-.22 1.41-.59",key:"mmje98"}],["path",{d:"M21 15V5a2 2 0 0 0-2-2H9",key:"43el77"}]]);/**
 * @license lucide-react v0.320.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=u("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.320.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=u("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.320.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=u("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.320.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=u("UtensilsCrossed",[["path",{d:"m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8",key:"n7qcjb"}],["path",{d:"M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7",key:"d0u48b"}],["path",{d:"m2.1 21.8 6.4-6.3",key:"yn04lh"}],["path",{d:"m19 5-7 7",key:"194lzd"}]]),Se=G((t,r)=>({items:[],lowStockItems:[],isLoading:!1,isLoadingLowStock:!1,error:null,errorLowStock:null,fetchItems:async()=>{if(!r().isLoading){t({isLoading:!0,error:null});try{const a=await ue();t({items:a,isLoading:!1})}catch(a){console.error("Error fetching pantry items for store:",a);const s=a instanceof Error?a.message:"Error desconocido al cargar despensa.";t({error:s,isLoading:!1})}}},fetchLowStockItems:async(a=1)=>(console.warn("fetchLowStockItems llamado pero no implementado en pantryService."),t({lowStockItems:[],isLoadingLowStock:!1,errorLowStock:"Funcionalidad no implementada"}),Promise.resolve()),addItem:async a=>{try{const s=await he(a);return t(i=>({items:[s,...i.items].sort((n,l)=>new Date(l.created_at).getTime()-new Date(n.created_at).getTime())})),s}catch(s){return console.error("Error adding pantry item via store:",s),null}},updateItem:async(a,s)=>{const i=r().items;t(n=>({items:n.items.map(l=>l.id===a?{...l,...s}:l)}));try{const n=await me(a,s);return t(l=>({items:l.items.map(o=>o.id===a?n:o)})),n}catch(n){return console.error("Error updating pantry item via store:",n),t({items:i}),null}},deleteItem:async a=>{const s=r().items;t(i=>({items:i.items.filter(n=>n.id!==a)}));try{return await de(a),!0}catch(i){return console.error("Error deleting pantry item via store:",i),t({items:s}),!1}}})),E="shopping_list_items",Ee=async()=>{const{data:{user:t}}=await h.auth.getUser();if(!t)throw new Error("Usuario no autenticado.");const{data:r,error:a}=await h.from(E).select("*").eq("user_id",t.id).order("is_purchased",{ascending:!0}).order("created_at",{ascending:!0});if(a)throw console.error("Error fetching shopping list items:",a),new Error("No se pudieron cargar los ítems de la lista de compras.");return r||[]},Ce=async t=>{const{data:{user:r}}=await h.auth.getUser();if(!r)throw new Error("Usuario no autenticado.");const a=t.quantity===void 0||t.quantity===null||isNaN(Number(t.quantity))?null:Number(t.quantity),s={...t,quantity:a,user_id:r.id,is_purchased:!1},{data:i,error:n}=await h.from(E).insert(s).select().single();if(n||!i)throw console.error("Error adding shopping list item:",n),new Error("No se pudo añadir el ítem a la lista de compras.");return i},Me=async(t,r)=>{const a={...r};if(a.quantity!==void 0){const n=a.quantity===null||isNaN(Number(a.quantity))?null:Number(a.quantity);a.quantity=n}const{data:s,error:i}=await h.from(E).update(a).eq("id",t).select().single();if(i||!s)throw console.error("Error updating shopping list item:",i),new Error("No se pudo actualizar el ítem.");return s},_e=async t=>{const{error:r}=await h.from(E).delete().eq("id",t);if(r)throw console.error("Error deleting shopping list item:",r),new Error("No se pudo eliminar el ítem.")},qe=async()=>{const{data:{user:t}}=await h.auth.getUser();if(!t)throw new Error("Usuario no autenticado.");const{error:r}=await h.from(E).delete().eq("user_id",t.id).eq("is_purchased",!0);if(r)throw console.error("Error clearing purchased items:",r),new Error("No se pudieron limpiar los ítems comprados.")},Q=G((t,r)=>({items:[],isLoading:!1,error:null,fetchItems:async()=>{if(!r().isLoading){t({isLoading:!0,error:null});try{const a=await Ee();t({items:a,isLoading:!1})}catch(a){console.error("Error fetching shopping list items for store:",a);const s=a instanceof Error?a.message:"Error desconocido al cargar lista.";t({error:s,isLoading:!1})}}},addItem:async a=>{try{const s=await Ce(a);return t(i=>({items:[...i.items,s].sort((n,l)=>n.is_purchased!==l.is_purchased?n.is_purchased?1:-1:new Date(n.created_at).getTime()-new Date(l.created_at).getTime())})),s}catch(s){return console.error("Error adding shopping list item via store:",s),null}},updateItem:async(a,s)=>{const i=r().items;t(n=>({items:n.items.map(l=>l.id===a?{...l,...s}:l).sort((l,o)=>l.is_purchased!==o.is_purchased?l.is_purchased?1:-1:new Date(l.created_at).getTime()-new Date(o.created_at).getTime())}));try{return await Me(a,s)}catch(n){return console.error("Error updating shopping list item via store:",n),t({items:i}),null}},deleteItem:async a=>{const s=r().items;t(i=>({items:i.items.filter(n=>n.id!==a)}));try{return await _e(a),!0}catch(i){return console.error("Error deleting shopping list item via store:",i),t({items:s}),!1}},clearPurchased:async()=>{const a=r().items,s=a.filter(i=>!i.is_purchased);t({items:s});try{return await qe(),!0}catch(i){return console.error("Error clearing purchased items via store:",i),t({items:a}),!1}}})),F=["Desayuno","Almuerzo","Merienda","Cena"],ze={Desayuno:{emoji:"🍳"},Almuerzo:{emoji:"🥗"},Merienda:{emoji:"🫖"},Cena:{emoji:"🌙"}},Ae={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.3}}};function Te({meals:t,today:r}){const a=[...t].sort((s,i)=>F.indexOf(s.meal_type)-F.indexOf(i.meal_type));return e.jsxs(k,{className:"h-full flex flex-col bg-white rounded-lg shadow-md border border-slate-200 overflow-hidden hover:shadow-lg",children:[e.jsxs(L,{className:"flex flex-row items-center justify-between pb-2 space-y-0",children:[e.jsxs(I,{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4 text-muted-foreground"}),"Plan de Hoy",e.jsxs("span",{className:"text-muted-foreground font-normal text-sm",children:["(",Z(r,"EEEE d",{locale:oe}),")"]})]}),e.jsx(c.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(y,{variant:"ghost",size:"sm",className:"h-7 -my-1 -mr-2 text-sm",asChild:!0,children:e.jsxs(w,{to:"/app/planning",children:["Ver Semana ",e.jsx(_,{className:"ml-1 h-3 w-3"})]})})})]}),e.jsx(S,{className:"pt-0 flex-grow min-h-0",children:e.jsx(c.div,{initial:"hidden",animate:"visible",variants:Ae,className:"h-full",children:a.length>0?e.jsx("ul",{className:"space-y-2 overflow-y-auto h-full pr-1",children:a.map(s=>{var i;return e.jsxs("li",{className:"flex items-center justify-between p-1.5 rounded-md bg-slate-50 hover:bg-slate-100 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-sm",children:((i=ze[s.meal_type])==null?void 0:i.emoji)||"🍽️"}),e.jsx("span",{className:"font-medium text-slate-700",children:s.meal_type})]}),e.jsx("span",{className:"text-slate-900 truncate max-w-[120px] sm:max-w-[150px] text-right",children:s.recipe_id&&s.recipes?e.jsx(w,{to:`/app/recipes/${s.recipe_id}`,className:"hover:underline hover:text-emerald-600",children:s.recipes.name}):s.custom_meal_name||"Comida personalizada"})]},s.id)})}):e.jsx($,{icon:e.jsx(Ie,{}),title:"Nada planeado para hoy",description:"Puedes añadir comidas desde la sección de Planificación.",className:"h-full justify-center py-6"})})})]})}const O={un:1,uno:1,una:1,dos:2,tres:3,cuatro:4,cinco:5,seis:6,siete:7,ocho:8,nueve:9,diez:10},Pe=["kg","kilo","kilos","gr","gramo","gramos","lt","litro","litros","paquete","paquetes","lata","latas","botella","botellas","unidad","unidades"];function Ve(t){let r=t.trim().toLowerCase(),a=null,s=null;const i=r.match(/^(\d+(\.\d+)?)\s+/),n=r.match(/^([a-zA-Záéíóúñ]+)\s+/);if(i?(a=parseFloat(i[1]),r=r.substring(i[0].length).trim()):n&&O[n[1]]&&(a=O[n[1]],r=r.substring(n[0].length).trim()),a!==null){const o=r.match(/^([a-zA-Záéíóúñ]+)\s+(de\s+)?/);o&&Pe.includes(o[1])&&(s=o[1],(s==="kilo"||s==="kilos")&&(s="kg"),(s==="gramo"||s==="gramos")&&(s="gr"),(s==="litro"||s==="litros")&&(s="lt"),r=r.substring(o[0].length).trim())}let l=r.trim();return!l||l==="de"?l=t:l=l.replace(/^./,o=>o.toUpperCase()).replace(/^De\s+/,""),{name:l||t,quantity:a,unit:s}}function De({onAddItem:t}){const[r,a]=d.useState(""),[s,i]=d.useState(!1),n=async l=>{l.preventDefault();const o=r.trim();if(o){i(!0);try{const p=Ve(o);await t(p),a("")}catch(p){console.error("Error passed to AddItemForm handler:",p)}finally{i(!1)}}};return e.jsxs("form",{onSubmit:n,className:"flex items-center gap-2 w-full",children:[e.jsx(fe,{type:"text",value:r,onChange:l=>a(l.target.value),placeholder:"Añadir ítem manualmente...",className:"flex-grow border-slate-300 focus:ring-emerald-500 focus:border-emerald-500",disabled:s,required:!0}),e.jsx(y,{type:"submit",disabled:s||!r.trim(),size:"icon",className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:s?e.jsx(f,{size:"sm",className:"text-white"}):e.jsx(ye,{className:"h-4 w-4"})})]})}const Re={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.3}}};function He({itemCount:t,isLoading:r,error:a}){const{addItem:s}=Q(),i=async n=>{const l=n.name;if(!l)throw H.error("No se pudo identificar el nombre del ítem."),new Error("Parsed item name is missing");const o=await s({name:l});if(o?H.success(`"${l}" añadido a la lista.`):H.error(`Error al añadir "${l}".`),!o)throw new Error("Failed to add item via store")};return e.jsxs(k,{className:"h-full flex flex-col bg-white rounded-lg shadow-md border border-slate-200 overflow-hidden hover:shadow-lg",children:[e.jsxs(L,{className:"flex flex-row items-center justify-between pb-2 space-y-0",children:[e.jsxs(I,{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"}),"Lista de Compras"]}),e.jsx(c.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(y,{variant:"ghost",size:"sm",className:"h-7 -my-1 -mr-2 text-sm",asChild:!0,children:e.jsxs(w,{to:"/app/shopping-list",children:["Ver Lista ",e.jsx(_,{className:"ml-1 h-3 w-3"})]})})})]}),e.jsx(S,{className:"pt-0 flex-grow",children:r?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(f,{size:"sm"})}):e.jsx(c.div,{initial:"hidden",animate:"visible",variants:Re,className:"h-full",children:a?e.jsx("p",{className:"text-sm text-destructive text-center py-4",children:a}):e.jsx("div",{className:"flex items-center gap-2 pt-2",children:e.jsxs("p",{className:"text-sm text-slate-700",children:["Tienes ",e.jsx("span",{className:"font-semibold text-lg text-slate-900",children:t})," ",t===1?"item":"items"," en tu lista."]})})})}),e.jsx(pe,{className:"p-2 border-t border-slate-200",children:e.jsx(De,{onAddItem:i})})]})}const $e={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.3}}},Ue={hidden:{opacity:0,y:-10},visible:{opacity:1,y:0},exit:{opacity:0,x:-10}};function Be({favoriteRecipes:t,isLoading:r,error:a}){return e.jsxs(k,{className:"h-full flex flex-col bg-white rounded-lg shadow-md border border-slate-200 overflow-hidden hover:shadow-lg",children:[e.jsxs(L,{className:"flex flex-row items-center justify-between pb-2 space-y-0",children:[e.jsxs(I,{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4 text-muted-foreground"}),"Recetas Favoritas"]}),e.jsx(c.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(y,{variant:"ghost",size:"sm",className:"h-7 -my-1 -mr-2 text-sm",asChild:!0,children:e.jsxs(w,{to:"/app/recipes?view=favorites",children:["Ver Todas ",e.jsx(_,{className:"ml-1 h-3 w-3"})]})})})]}),e.jsx(S,{className:"pt-0 flex-grow min-h-0",children:r?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(f,{size:"sm"})}):e.jsx(c.div,{initial:"hidden",animate:"visible",variants:$e,className:"h-full",children:a?e.jsx("p",{className:"text-sm text-destructive text-center py-4",children:a}):t.length>0?e.jsxs("ul",{className:"space-y-1.5 overflow-y-auto h-full pr-1",children:[e.jsx(W,{initial:!1,children:t.slice(0,5).map(s=>e.jsx(c.li,{variants:Ue,initial:"hidden",animate:"visible",exit:"exit",layout:!0,className:"hover:bg-slate-100 rounded",children:e.jsxs(w,{to:`/app/recipes/${s.id}`,className:"flex items-center gap-2 p-1.5 text-sm text-slate-900 hover:text-emerald-600",children:[e.jsx("div",{className:"w-8 h-8 rounded bg-muted flex items-center justify-center flex-shrink-0",children:e.jsx(Ne,{className:"h-4 w-4 text-slate-400"})}),e.jsx("span",{className:"truncate flex-grow",children:s.name||"Receta sin nombre"})]})},s.id))}),t.length>5&&e.jsxs("li",{className:"text-xs text-slate-500 text-center pt-1",children:["...y ",t.length-5," más"]})]}):e.jsx($,{icon:e.jsx(ve,{}),title:"Sin favoritas",description:"Marca tus recetas preferidas con una estrella para verlas aquí.",className:"h-full justify-center py-6"})})})]})}const Fe={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.3}}},Oe={hidden:{opacity:0,y:-10},visible:{opacity:1,y:0},exit:{opacity:0,x:-10}};function We({lowStockItems:t,isLoading:r,error:a}){const s=t.length;return e.jsxs(k,{className:"h-full flex flex-col bg-white rounded-lg shadow-md border border-slate-200 overflow-hidden hover:shadow-lg",children:[e.jsxs(L,{className:"flex flex-row items-center justify-between pb-2 space-y-0",children:[e.jsxs(I,{className:"text-lg font-medium flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"}),"Despensa Baja"]}),e.jsx(c.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsx(y,{variant:"ghost",size:"sm",className:"h-7 -my-1 -mr-2 text-sm",asChild:!0,children:e.jsxs(w,{to:"/app/pantry",children:["Ver Despensa ",e.jsx(_,{className:"ml-1 h-3 w-3"})]})})})]}),e.jsx(S,{className:"pt-0 flex-grow min-h-0",children:r?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(f,{size:"sm"})}):e.jsx(c.div,{initial:"hidden",animate:"visible",variants:Fe,className:"h-full",children:a?e.jsx("p",{className:"text-sm text-destructive text-center py-4",children:a}):s>0?e.jsxs("div",{className:"pt-2 h-full flex flex-col",children:[e.jsxs("p",{className:"text-sm text-slate-700 mb-2 flex-shrink-0",children:["Tienes ",e.jsx("span",{className:"font-semibold text-orange-600",children:s})," ",s===1?"item":"items"," con stock bajo (≤1)."]}),e.jsxs("ul",{className:"space-y-1 overflow-y-auto flex-grow min-h-0 pr-1",children:[e.jsx(W,{initial:!1,children:t.slice(0,7).map(i=>e.jsxs(c.li,{variants:Oe,initial:"hidden",animate:"visible",exit:"exit",layout:!0,className:"text-xs text-slate-600 flex items-center gap-1.5",children:[e.jsx(je,{className:"h-3.5 w-3.5 text-amber-500 flex-shrink-0"}),e.jsxs("span",{className:"truncate",children:[i.name," ",i.quantity!==null?`(${i.quantity} ${i.unit||""})`:"(Sin cantidad)"]})]},i.id))}),s>7&&e.jsxs("li",{className:"text-xs text-slate-500 text-center pt-1",children:["...y ",s-7," más"]})]})]}):e.jsx($,{icon:e.jsx(we,{}),title:"¡Despensa surtida!",description:"No hay ítems con stock bajo.",className:"h-full justify-center py-6"})})})]})}const Ze=t=>{const r=t.getHours();return r<12?"Buenos días":r<20?"Buenas tardes":"Buenas noches"},Ge=t=>({hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:t?0:.08}}}),Qe=t=>({hidden:{opacity:0,y:t?0:20},visible:{opacity:1,y:0,transition:{type:"spring",stiffness:260,damping:20}}}),Ke=t=>({hidden:{opacity:0,x:t?0:-20},visible:{opacity:1,x:0,transition:{delay:.1,type:"spring",stiffness:300,damping:25}}});function ds(){const{user:t,profile:r}=le(),[a,s]=d.useState([]),[i,n]=d.useState(!0),[l,o]=d.useState(null),{lowStockItems:p,isLoadingLowStock:C,errorLowStock:K,fetchLowStockItems:q,items:z}=Se(),{items:A,isLoading:T,error:J,fetchItems:U}=Q(),X=!1,Y=null,[x,v]=d.useState(null),[j,P]=d.useState(!1),[M,N]=d.useState(null),V=new Date,D=Z(V,"yyyy-MM-dd"),ee=Ze(V),R=re(),se=Ge(R),b=Qe(R),te=Ke(R);d.useEffect(()=>{n(!0),o(null),ce(D,D).then(m=>s(m)).catch(m=>{console.error("Error loading today's meals:",m),o("Error al cargar plan de hoy.")}).finally(()=>n(!1))},[D]),d.useEffect(()=>{(z.length===0&&!C||z.length>0&&p.length===0&&!C)&&q()},[z.length,p.length,C,q]),d.useEffect(()=>{A.length===0&&!T&&U()},[A.length,T,U]);const ae=d.useMemo(()=>[],[]),B=d.useCallback(async()=>{const m=t;if(!(m!=null&&m.id)){N("Debes iniciar sesión para obtener sugerencias.");return}P(!0),N(null),v(null);try{console.log("[Dashboard] Solicitando sugerencia de receta...");const g=await xe(m.id,"una sugerencia de receta para hoy");console.log("[Dashboard] Resultado de sugerencia:",g),"error"in g?(N(g.error),v(null)):v(g)}catch(g){console.error("[Dashboard] Error inesperado al obtener sugerencia:",g),N(g.message||"Error inesperado al obtener la sugerencia."),v(null)}finally{P(!1)}},[t,N,P,v]);return e.jsxs(c.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},className:"container mx-auto max-w-6xl py-8 px-4 space-y-6",children:[e.jsxs(c.div,{initial:"hidden",animate:"visible",variants:te,className:"mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[ee,r!=null&&r.username?`, ${r.username}`:"","! 👋"]}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"Tu resumen de cocina."})]}),e.jsx(c.div,{variants:b,className:"mb-6",initial:"hidden",animate:"visible",children:e.jsxs(k,{className:"bg-white border border-slate-200 shadow-md rounded-lg",children:[e.jsxs(L,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(I,{className:"text-lg font-semibold text-slate-900",children:"Sugerencia del Día"}),e.jsxs(y,{variant:"outline",size:"sm",onClick:B,disabled:j,children:[j?e.jsx(f,{size:"sm",className:"mr-2"}):e.jsx(be,{className:"mr-2 h-4 w-4"}),"¿Qué cocino hoy?"]})]}),e.jsxs(S,{children:[j&&e.jsx("div",{className:"flex justify-center items-center h-24",children:e.jsx(f,{})}),M&&e.jsx("p",{className:"text-red-500 text-sm text-center py-4",children:M}),!j&&!M&&x&&e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("h4",{className:"font-semibold text-md mb-1 text-emerald-700",children:x.title}),e.jsx("p",{className:"text-sm text-slate-600 line-clamp-3",children:x.description}),e.jsxs("div",{className:"text-xs text-slate-500 mt-2 flex items-center gap-3",children:[e.jsxs("span",{children:["Prep: ",x.prepTimeMinutes," min"]}),e.jsxs("span",{children:["Cocción: ",x.cookTimeMinutes," min"]}),e.jsxs("span",{children:["Porciones: ",x.servings]})]})]}),e.jsx(y,{variant:"ghost",size:"icon",onClick:B,disabled:j,className:"text-slate-500 hover:text-emerald-600 flex-shrink-0 mt-2 sm:mt-0","aria-label":"Obtener otra sugerencia",children:e.jsx(ke,{className:"h-4 w-4"})})]}),!j&&!M&&!x&&e.jsx("p",{className:"text-sm text-slate-500 text-center py-4",children:'Haz clic en "¿Qué cocino hoy?" para obtener una sugerencia basada en tu perfil y despensa.'})]})]})}),e.jsxs(c.div,{variants:se,initial:"hidden",animate:"visible",className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:[e.jsx(c.div,{variants:b,className:"md:col-span-1 xl:col-span-1",children:i?e.jsx("div",{className:"flex justify-center items-center h-40 bg-white rounded-lg shadow-md border border-slate-200",children:e.jsx(f,{})}):e.jsx(Te,{meals:a,today:V})}),e.jsx(c.div,{variants:b,className:"md:col-span-1 xl:col-span-1",children:e.jsx(He,{itemCount:A.length,isLoading:T,error:J})}),e.jsx(c.div,{variants:b,className:"md:col-span-1 xl:col-span-1",children:e.jsx(We,{lowStockItems:p,isLoading:C,error:K})}),e.jsx(c.div,{variants:b,className:"md:col-span-2 xl:col-span-3",children:e.jsx(Be,{favoriteRecipes:ae,isLoading:X,error:Y})})]})]})}export{ds as DashboardPage};
