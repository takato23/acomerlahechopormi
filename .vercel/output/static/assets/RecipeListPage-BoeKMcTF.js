import{r as c,j as e}from"./framer-motion-DexFYn3r.js";import{c as ne,k as ie,l as oe,e as ce,P as Q,j as le,h as T,B as P,p as de,u as pe,S as K,L as V}from"./index-o6bm3qdW.js";import{D as me,f as ue,a as ge,b as he,c as fe,g as xe,d as ve}from"./dialog-C1OzTA5U.js";import{T as be}from"./textarea-fVM2PcUd.js";import{L as F}from"./label-Ctjrl553.js";import{u as je,a as ye}from"./index-B3hHUwxe.js";import{U as we,u as Ne}from"./recipeStore-arakxWCU.js";import{g as ke}from"./pantryService-1OnSk01a.js";import{g as Ce}from"./userService-CZh88SKG.js";import{C as Se,a as Pe,c as Ae,b as Ee,e as Re}from"./card-CGU5HWmE.js";import{A as Te,a as Ie,b as _e,c as De,d as Oe,e as Fe,f as Ge,g as Me,h as Le}from"./alert-dialog-CCeH0div.js";import{C as $e}from"./clock-BTl63eEv.js";import{H as Je}from"./heart-CBpYyj4Y.js";import{T as ze}from"./trash-2-CpjvPaTx.js";import{E as qe}from"./EmptyState-Cb4z0I15.js";import{S as He}from"./sparkles-CmyYQTht.js";import{C as Ue}from"./clipboard-list-kGvGclxl.js";import"./recipeService-wNgNlfn2.js";import"./react-eoYhWYcX.js";/**
 * @license lucide-react v0.320.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=ne("PlusCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);var M="Switch",[Be,bs]=ce(M),[Ke,Ve]=Be(M),W=c.forwardRef((s,t)=>{const{__scopeSwitch:n,name:a,checked:l,defaultChecked:p,required:m,disabled:i,value:j="on",onCheckedChange:k,form:A,...y}=s,[v,O]=c.useState(null),I=ie(t,N=>O(N)),b=c.useRef(!1),E=v?A||!!v.closest("form"):!0,[h=!1,w]=oe({prop:l,defaultProp:p,onChange:k});return e.jsxs(Ke,{scope:n,checked:h,disabled:i,children:[e.jsx(Q.button,{type:"button",role:"switch","aria-checked":h,"aria-required":m,"data-state":ee(h),"data-disabled":i?"":void 0,disabled:i,value:j,...y,ref:I,onClick:le(s.onClick,N=>{w(f=>!f),E&&(b.current=N.isPropagationStopped(),b.current||N.stopPropagation())})}),E&&e.jsx(Xe,{control:v,bubbles:!b.current,name:a,value:j,checked:h,required:m,disabled:i,form:A,style:{transform:"translateX(-100%)"}})]})});W.displayName=M;var Y="SwitchThumb",Z=c.forwardRef((s,t)=>{const{__scopeSwitch:n,...a}=s,l=Ve(Y,n);return e.jsx(Q.span,{"data-state":ee(l.checked),"data-disabled":l.disabled?"":void 0,...a,ref:t})});Z.displayName=Y;var Xe=s=>{const{control:t,checked:n,bubbles:a=!0,...l}=s,p=c.useRef(null),m=je(n),i=ye(t);return c.useEffect(()=>{const j=p.current,k=window.HTMLInputElement.prototype,y=Object.getOwnPropertyDescriptor(k,"checked").set;if(m!==n&&y){const v=new Event("click",{bubbles:a});y.call(j,n),j.dispatchEvent(v)}},[m,n,a]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...l,tabIndex:-1,ref:p,style:{...s.style,...i,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function ee(s){return s?"checked":"unchecked"}var se=W,Qe=Z;const G=c.forwardRef(({className:s,...t},n)=>e.jsx(se,{className:T("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...t,ref:n,children:e.jsx(Qe,{className:T("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));G.displayName=se.displayName;const We=({recipe:s,className:t,onToggleFavorite:n,onDelete:a})=>{const l=s.prep_time_minutes??0,p=s.cook_time_minutes??0,m=l+p;return e.jsxs(Se,{className:T("bg-white border border-slate-200 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-200 overflow-hidden",t),children:[s.image_url&&e.jsx("div",{className:"h-48 overflow-hidden",children:e.jsx("img",{src:s.image_url,alt:s.title,className:"object-cover w-full h-full"})}),e.jsx(Pe,{className:"p-4",children:e.jsx(Ae,{className:"text-lg font-semibold",children:s.title})}),e.jsxs(Ee,{className:"p-4 pt-0",children:[s.description&&e.jsx("p",{className:"text-sm text-slate-600 mb-3 line-clamp-3",children:s.description}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-slate-500",children:[m>0&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx($e,{className:"h-4 w-4"}),e.jsxs("span",{children:[m," min"]})]}),s.servings&&s.servings>0&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.servings," ",s.servings===1?"porción":"porciones"]})]})]})]}),e.jsxs(Re,{className:"p-2 pt-0 flex justify-end gap-1",children:[e.jsx(P,{variant:"ghost",size:"icon",className:T("h-8 w-8",s.is_favorite?"text-red-500 hover:text-red-600":"text-muted-foreground hover:text-red-500"),onClick:i=>{i.stopPropagation(),n(s.id)},"aria-label":s.is_favorite?"Quitar de favoritos":"Añadir a favoritos",children:e.jsx(Je,{className:T("h-4 w-4",s.is_favorite&&"fill-current")})}),e.jsxs(Te,{children:[e.jsx(Ie,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:i=>i.stopPropagation(),"aria-label":"Eliminar receta",children:e.jsx(ze,{className:"h-4 w-4"})})}),e.jsxs(_e,{onClick:i=>i.stopPropagation(),children:[e.jsxs(De,{children:[e.jsx(Oe,{children:"¿Eliminar Receta?"}),e.jsxs(Fe,{children:['Esta acción no se puede deshacer. Se eliminará permanentemente la receta "',s.title,'".']})]}),e.jsxs(Ge,{children:[e.jsx(Me,{children:"Cancelar"}),e.jsx(Le,{onClick:()=>a(s.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Eliminar"})]})]})]})]})]})},Ye=(s,t,n)=>{let a="";return n&&n.length>0?(a=`Genera una receta de cocina creativa utilizando principalmente los siguientes ingredientes que tengo disponibles: ${n.join(", ")}. `,s.trim()&&(a+=`Considera también esta descripción adicional: "${s}". `),a+=`Puedes usar otros ingredientes comunes si es necesario.

`):a=`Genera una receta de cocina basada en la siguiente descripción: "${s}".

`,t&&(a+=`Considera las siguientes preferencias del usuario:
`,t.dietary_preference&&(a+=`- Preferencia dietética: ${t.dietary_preference}
`),t.allergies_restrictions&&(a+=`- Alergias/Restricciones: ${t.allergies_restrictions}
`),t.difficulty_preference&&(a+=`- Dificultad preferida: ${t.difficulty_preference}
`),t.max_prep_time&&(a+=`- Tiempo máximo de preparación: ${t.max_prep_time} minutos
`),a+=`
`),a+="Formatea la respuesta completa como un único objeto JSON válido contenido dentro de un bloque de código JSON (```json ... ```). El objeto JSON debe tener las siguientes claves: 'title' (string), 'description' (string), 'prepTimeMinutes' (number), 'cookTimeMinutes' (number), 'servings' (number), 'ingredients' (array of objects with 'quantity' (string o number), 'unit' (string, puede ser null o vacío), 'name' (string)), y 'instructions' (array of strings).",a},js=()=>{const s=de(),{user:t,session:n}=pe(),{recipes:a,isLoading:l,error:p,fetchRecipes:m,toggleFavorite:i,deleteRecipe:j,showOnlyFavorites:k,toggleFavoriteFilter:A}=Ne(),[y,v]=c.useState(!1),[O,I]=c.useState(!1),[b,E]=c.useState(""),[h,w]=c.useState(!1),[N,f]=c.useState(null);c.useEffect(()=>{t!=null&&t.id&&m(t.id)},[t==null?void 0:t.id,m]);const te=async()=>{var L,$,J,z,q,H,U;const u=y;if(!b.trim()&&!u){f("Por favor, introduce una descripción o selecciona 'Usar ingredientes de mi despensa'.");return}if(!n||!(t!=null&&t.id)){f("Necesitas iniciar sesión para generar recetas.");return}w(!0),f(null);try{let x,R=null;try{R=await Ce(t.id),x=(R==null?void 0:R.gemini_api_key)??void 0,console.log("API Key obtenida del perfil de usuario.")}catch(r){console.warn("No se pudo obtener el perfil del usuario o la clave API del perfil:",r)}if(x||(x="AIzaSyB0rXAlRRLVcV0iykwbA0v9eTfIyAz5uI8",x&&console.log("API Key obtenida de las variables de entorno.")),!x)throw new Error("No API key available. Please set it in your profile or configure VITE_GEMINI_API_KEY.");const ae=R;let C;if(u){console.log("Intentando obtener ingredientes de la despensa...");try{const r=await ke();if(r&&r.length>0)if(C=r.map(d=>{var D;return(D=d.ingredient)==null?void 0:D.name}).filter(d=>!!d&&d.trim()!==""),C&&C.length===0){console.warn("La despensa contiene items pero sin nombres válidos."),f("No se encontraron nombres válidos en los ingredientes de tu despensa. Revisa tus items."),w(!1);return}else console.log("Ingredientes de la despensa obtenidos:",C);else{console.log("La despensa está vacía."),f("Tu despensa está vacía. Añade ingredientes o desmarca la opción para generar una receta general."),w(!1);return}}catch(r){console.error("Error al obtener ingredientes de la despensa:",r),f(`Error al obtener la despensa: ${r.message||"Error desconocido"}`),w(!1);return}}console.log(`Construyendo prompt ${u&&C?"con":"sin"} ingredientes de despensa.`);const B=Ye(b,ae??void 0,C);console.log("Prompt final para Gemini:",B),console.log("Llamando a la API de Gemini...");const re=`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${x}`,S=await fetch(re,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:B}]}],generationConfig:{responseMimeType:"application/json"}})});if(!S.ok){const r=await S.text();let d={};try{d=JSON.parse(r)}catch{console.error("Respuesta de error API no es JSON:",r)}console.error("Error API Google:",S.status,S.statusText,d);const D=((L=d==null?void 0:d.error)==null?void 0:L.message)||`Error API Google: ${S.statusText}`;throw new Error(D)}const g=await S.json();if(console.log("Respuesta cruda de Gemini:",g),($=g.promptFeedback)!=null&&$.blockReason)throw console.error("Respuesta bloqueada por Google:",g.promptFeedback),new Error(`Solicitud bloqueada por seguridad: ${g.promptFeedback.blockReason}`);if(!g.candidates||g.candidates.length===0||!((q=(z=(J=g.candidates[0].content)==null?void 0:J.parts)==null?void 0:z[0])!=null&&q.text)){console.error("Respuesta inesperada de Google (sin contenido válido):",g);const r=(U=(H=g.candidates)==null?void 0:H[0])==null?void 0:U.finishReason;throw r&&r!=="STOP"?new Error(`La generación de la receta falló o fue detenida (${r}).`):new Error("No se recibió contenido de receta válido en la respuesta de la API.")}const _=g.candidates[0].content.parts[0].text;console.log("Texto JSON recibido:",_);let o=null;try{if(o=JSON.parse(_),!o||typeof o.title!="string"||!Array.isArray(o.ingredients)||!Array.isArray(o.instructions)||typeof o.prepTimeMinutes!="number"||typeof o.cookTimeMinutes!="number"||typeof o.servings!="number")throw console.error("JSON parseado pero con formato inválido o tipos incorrectos:",o),new Error("Formato JSON de receta inválido o incompleto.");o.ingredients=o.ingredients.map(r=>({quantity:r.quantity??"",unit:r.unit??"",name:r.name??"Ingrediente desconocido"})).filter(r=>r.name!=="Ingrediente desconocido"&&r.name.trim()!=="")}catch(r){console.error("Error al parsear la respuesta JSON de la API:",r,_);const d=_.substring(0,100);throw new Error(`La respuesta de la API no contenía un JSON de receta válido. Inicio: ${d}...`)}console.log("Receta generada y parseada, navegando:",o),s("/app/recipes/new",{state:{generatedRecipe:o}}),I(!1),E(""),v(!1)}catch(x){console.error("Error generando receta:",x),f(x.message||"Ocurrió un error inesperado al generar la receta.")}finally{w(!1)}};return e.jsxs("div",{className:"container mx-auto p-4 md:p-6 lg:p-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Mis Recetas"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(me,{open:O,onOpenChange:I,children:[e.jsx(ue,{asChild:!0,children:e.jsxs(P,{variant:"default",children:[e.jsx(He,{className:"mr-2 h-4 w-4"})," Generar con IA"]})}),e.jsxs(ge,{className:"sm:max-w-[425px]",children:[e.jsxs(he,{children:[e.jsx(fe,{children:"Generar Receta con IA"}),e.jsx(xe,{children:"Describe qué tipo de receta te gustaría crear (ingredientes, tipo de plato, etc.)."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(F,{htmlFor:"prompt",className:"text-right",children:"Descripción"}),e.jsx(be,{id:"prompt",value:b,onChange:u=>E(u.target.value),className:"col-span-3",placeholder:"Ej: Una tarta de manzana fácil y rápida",disabled:h})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2 col-span-4 justify-end",children:[" ",e.jsx(G,{id:"use-pantry",checked:y,onCheckedChange:v,disabled:h}),e.jsx(F,{htmlFor:"use-pantry",children:"Usar ingredientes de mi despensa"})]}),N&&e.jsx("p",{className:"text-red-500 text-sm col-span-4 text-center mt-2",children:N})]}),e.jsx(ve,{children:e.jsxs(P,{type:"button",onClick:te,disabled:h||!b.trim(),children:[h?e.jsx(K,{size:"sm",className:"mr-2"}):null,"Generar Receta"]})})]})]}),e.jsx(P,{variant:"outline",asChild:!0,children:e.jsxs(V,{to:"/app/recipes/new",children:[e.jsx(X,{className:"mr-2 h-4 w-4"})," Añadir Manualmente"]})})]})]}),e.jsx("div",{className:"flex justify-end items-center mb-4 gap-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{id:"favorites-filter",checked:k,onCheckedChange:A}),e.jsx(F,{htmlFor:"favorites-filter",children:"Mostrar solo favoritos"})]})}),l&&e.jsx("div",{className:"flex justify-center mt-10",children:e.jsx(K,{size:"lg"})}),p&&e.jsxs("p",{className:"text-red-500 text-center mt-10",children:["Error al cargar recetas: ",p]}),!l&&!p&&a.length===0&&e.jsx(qe,{icon:e.jsx(Ue,{className:"h-16 w-16"}),title:"Aún no has añadido ninguna receta",description:"¡Empieza creando una manualmente o generando una con IA!",action:e.jsx(V,{to:"/app/recipes/new",children:e.jsxs(P,{children:[e.jsx(X,{className:"mr-2 h-4 w-4"})," Añadir Receta Manualmente"]})}),className:"mt-10"}),!l&&!p&&a.length>0&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:a.filter(u=>k?u.is_favorite:!0).map(u=>e.jsx(We,{recipe:u,onToggleFavorite:i,onDelete:j},u.id))})]})};export{js as RecipeListPage};
