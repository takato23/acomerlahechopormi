import{r as s,j as e}from"./framer-motion-DexFYn3r.js";import{B as A}from"./index-o6bm3qdW.js";import{I as l}from"./input-DTFkI6V9.js";import{L as r}from"./label-Ctjrl553.js";import{S as J,a as K,b as W,c as X,d as Z}from"./select-DBfGXf_6.js";import{D as E,a as T,b as ee,c as ae,d as te,e as se}from"./dialog-C1OzTA5U.js";import{u as re,s as le}from"./useDebounce-Cu73n7FP.js";import"./index-zM9kQwqA.js";import"./index-BMd2TyCU.js";import"./index-B3hHUwxe.js";import"./chevron-down-D8MEcRXF.js";import"./check-BwO51OGf.js";import"./chevron-up-DGjrEF3Z.js";const B=["unidad","unidades","g","kg","ml","l","cucharadita","cucharada","taza","pizca","paquete","lata","botella","frasco","caja","diente","ramita","hoja"],fe=({isOpen:i,onClose:S,onSubmit:V,itemToEdit:t,categories:$})=>{var U;const[o,C]=s.useState(!1),[d,m]=s.useState(""),[k,u]=s.useState(""),[O,D]=s.useState(""),[F,g]=s.useState(""),[M,h]=s.useState(""),[w,p]=s.useState(""),[I,x]=s.useState(""),[G,j]=s.useState(""),[_,N]=s.useState(""),[q,f]=s.useState(""),[L,b]=s.useState(""),[P,v]=s.useState(!1),H=s.useRef(null),y=re(d,400);s.useEffect(()=>{var a,n;t?(m(((a=t.ingredient)==null?void 0:a.name)||""),u(t.quantity??""),D(t.unit||""),g(t.category_id||""),h(t.expiry_date||""),p(t.location||""),x(t.price??""),j(t.notes||""),N(t.min_stock??""),f(t.target_stock??""),b(((n=t.tags)==null?void 0:n.join(", "))||"")):(m(""),u(""),D(B[0]||""),g(""),h(""),p(""),x(""),j(""),N(""),f(""),b(""),v(!1))},[t,i]),s.useEffect(()=>{if(!t&&y&&!P){const a=le(y);a&&a!==F&&(console.log(`Suggesting category ${a} for "${y}"`),g(a))}},[y,t,P]);const R=async a=>{C(!0);let n;const z={quantity:k===""?null:Number(k),unit:O||null,category_id:F||null,expiry_date:M||null,location:w||null,price:I===""?null:Number(I),notes:G||null,min_stock:_===""?null:Number(_),target_stock:q===""?null:Number(q),tags:L.split(",").map(c=>c.trim()).filter(c=>c.length>0)||null};if(t)n={...z};else{if(!d.trim()){console.error("El nombre del ingrediente es requerido."),C(!1);return}n={...z,ingredient_name:d.trim()}}i||v(!1);const Y=()=>{var c;m(""),u(""),h(""),p(""),x(""),j(""),N(""),f(""),b(""),v(!1),(c=H.current)==null||c.focus()};try{await V(n,a),a?S():Y()}catch(c){console.error("Error submitting pantry item:",c)}finally{C(!1)}},Q=a=>{g(a),v(!0)};return i?e.jsx(E,{open:i,onOpenChange:S,children:e.jsxs(T,{className:"sm:max-w-[425px]",children:[e.jsx(ee,{children:e.jsx(ae,{children:t?"Editar Item":"Añadir Item a la Despensa"})}),e.jsxs("form",{className:"grid gap-4 py-4",children:[!t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(r,{htmlFor:"itemName",className:"text-right text-slate-700",children:"Nombre*"}),e.jsx(l,{id:"itemName",value:d,onChange:a=>m(a.target.value),className:"col-span-3 border-slate-300 focus:ring-emerald-500 focus:border-emerald-500",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(r,{htmlFor:"location",className:"text-right text-slate-700",children:"Ubicación"}),e.jsx(l,{id:"location",value:w,onChange:a=>p(a.target.value),className:"col-span-3 border-slate-300 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Ej: Nevera, Despensa..."})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(r,{htmlFor:"price",className:"text-right text-slate-700",children:"Precio"}),e.jsx(l,{id:"price",type:"number",value:I,onChange:a=>x(a.target.value===""?"":Number(a.target.value)),className:"col-span-3 border-slate-300 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Opcional (ej: 1.50)",step:"0.01"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(r,{htmlFor:"notes",className:"text-right text-slate-700",children:"Notas"}),e.jsx(l,{id:"notes",value:G,onChange:a=>j(a.target.value),className:"col-span-3 border-slate-300 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Opcional..."})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(r,{htmlFor:"minStock",className:"text-right text-slate-700",children:"Stock Mín."}),e.jsx(l,{id:"minStock",type:"number",value:_,onChange:a=>N(a.target.value===""?"":Number(a.target.value)),className:"col-span-3 border-slate-300 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Opcional",step:"any"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(r,{htmlFor:"targetStock",className:"text-right text-slate-700",children:"Stock Obj."}),e.jsx(l,{id:"targetStock",type:"number",value:q,onChange:a=>f(a.target.value===""?"":Number(a.target.value)),className:"col-span-3 border-slate-300 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Opcional",step:"any"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(r,{htmlFor:"tags",className:"text-right text-slate-700",children:"Etiquetas"}),e.jsx(l,{id:"tags",value:L,onChange:a=>b(a.target.value),className:"col-span-3 border-slate-300 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Ej: sin gluten, vegano, oferta"}),e.jsx("p",{className:"col-start-2 col-span-3 text-xs text-muted-foreground -mt-3",children:"Separadas por comas."})]})]}),t&&e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(r,{className:"text-right text-slate-700",children:"Nombre"}),e.jsx("p",{className:"col-span-3 font-medium",children:((U=t.ingredient)==null?void 0:U.name)||"N/A"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(r,{htmlFor:"quantity",className:"text-right text-slate-700",children:"Cantidad"}),e.jsx(l,{id:"quantity",type:"number",value:k,onChange:a=>u(a.target.value===""?"":Number(a.target.value)),className:"col-span-3 border-slate-300 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Ej: 1, 500, 0.5",step:"any"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(r,{htmlFor:"unit",className:"text-right text-slate-700",children:"Unidad"}),e.jsx(l,{id:"unit",value:O,onChange:a=>D(a.target.value),className:"col-span-3 border-slate-300 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Ej: kg, L, unidad, paquete",list:"common-units"}),e.jsx("datalist",{id:"common-units",children:B.map(a=>e.jsx("option",{value:a},a))})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(r,{htmlFor:"category",className:"text-right text-slate-700",children:"Categoría"}),e.jsxs(J,{value:F,onValueChange:Q,children:[e.jsx(K,{id:"category",className:"col-span-3 border-slate-300 focus:ring-emerald-500 focus:border-emerald-500",children:e.jsx(W,{placeholder:"Selecciona categoría..."})}),e.jsx(X,{children:$.map(a=>e.jsx(Z,{value:a.id,children:a.name},a.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(r,{htmlFor:"expiryDate",className:"text-right text-slate-700",children:"Caducidad"}),e.jsx(l,{id:"expiryDate",type:"date",value:M,onChange:a=>h(a.target.value),className:"col-span-3 border-slate-300 focus:ring-emerald-500 focus:border-emerald-500"})]})]}),e.jsxs(te,{className:"sm:justify-between gap-2",children:[e.jsx(se,{asChild:!0,children:e.jsx(A,{type:"button",variant:"outline",onClick:S,disabled:o,className:"border-slate-300 text-slate-700 hover:bg-slate-50",children:"Cancelar"})}),e.jsxs("div",{className:"flex gap-2",children:[!t&&e.jsx(A,{type:"button",variant:"secondary",onClick:()=>R(!1),disabled:o,className:"bg-slate-100 text-slate-900 hover:bg-slate-200",children:o?"Guardando...":"Guardar y Añadir Otro"}),e.jsx(A,{type:"button",onClick:()=>R(!0),disabled:o,className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:o?"Guardando...":t?"Guardar Cambios":"Añadir Item"})]})]})]})}):null};export{fe as default};
