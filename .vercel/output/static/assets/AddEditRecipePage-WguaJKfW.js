import{j as e,r}from"./framer-motion-DexFYn3r.js";import{C as S,a as I,c as E,b as w}from"./card-CGU5HWmE.js";import{q as K,p as Q,r as V,u as W,b as u,B as H,n as X}from"./index-o6bm3qdW.js";import{I as f}from"./input-DTFkI6V9.js";import{T as F}from"./textarea-fVM2PcUd.js";import{L as p}from"./label-Ctjrl553.js";import{a as Y}from"./recipeService-wNgNlfn2.js";const Z=()=>{const{recipeId:i}=K(),v=Q(),R=V(),{user:N}=W(),[ee,ae]=r.useState(!1),[n,k]=r.useState(!1),[L,M]=r.useState(null),[c,q]=r.useState(""),[T,A]=r.useState(""),[y,D]=r.useState([]),[x,P]=r.useState([]),[g,_]=r.useState(""),[h,$]=r.useState(""),[b,z]=r.useState("");r.useEffect(()=>{var s,l;const a=(s=R.state)==null?void 0:s.generatedRecipe;a&&!i?(console.log("Receta generada recibida, poblando formulario:",a),q(a.title||""),A(a.description||""),D(((l=a.ingredients)==null?void 0:l.map(d=>({name:d.name||"",quantity:String(d.quantity??""),unit:d.unit||""})))||[]),P(a.instructions||[]),_(String(a.prepTimeMinutes??"")),$(String(a.cookTimeMinutes??"")),z(a.servings??""),window.history.replaceState({},document.title)):i&&console.log("Modo Edición - ID:",i)},[R.state,i]);const B=a=>a.filter(s=>s.name&&s.name.trim()!=="").map(s=>`${s.quantity||""} ${s.unit||""} ${s.name}`.trim()).join(`
`),G=a=>{const s=[],l=a.split(`
`);for(const d of l){const C=d.trim();if(!C)continue;const t=C.split(" ");let j=null,m=null,o="";t.length>=3&&!isNaN(parseFloat(t[0].replace(",",".")))?(j=t[0],isNaN(parseFloat(t[1].replace(",",".")))?(m=t[1],o=t.slice(2).join(" ")):(m=null,o=t.slice(1).join(" "))):t.length>=2&&isNaN(parseFloat(t[0].replace(",",".")))?(j=null,m=t[0],o=t.slice(1).join(" ")):(j=null,m=null,o=C),o.trim()&&s.push({quantity:j,unit:m,name:o.trim()})}return s},U=a=>a.map((s,l)=>`${l+1}. ${s}`).join(`
`),O=a=>a.split(`
`).map(s=>s.replace(/^\d+\.\s*/,"").trim()).filter(s=>s),J=r.useCallback(async()=>{if(!N){u.error("Debes iniciar sesión para guardar recetas.");return}if(!c.trim()){u.error("El título de la receta es obligatorio.");return}k(!0),M(null);const a={user_id:N.id,title:c.trim(),description:T.trim()||null,instructions:Array.isArray(x)?x:[],prep_time_minutes:g&&parseInt(g,10)||null,cook_time_minutes:h&&parseInt(h,10)||null,servings:b&&parseInt(String(b),10)||null,ingredients:y.filter(s=>s.name&&s.name.trim()!=="").map(s=>({name:s.name.trim(),quantity:s.quantity,unit:s.unit||null})),image_url:null,tags:null};try{i?(console.warn("Actualización de receta no implementada."),u.info("La actualización de recetas aún no está implementada.")):(await Y(a),u.success("Receta guardada con éxito!")),v("/app/recipes")}catch(s){console.error("Error al guardar receta:",s),M(s.message||"Ocurrió un error desconocido al guardar."),u.error(`Error al guardar: ${s.message||"desconocido"}`)}finally{k(!1)}},[N,c,T,y,x,g,h,b,i,v]);return e.jsxs("div",{className:"container mx-auto p-4 max-w-4xl",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6 text-slate-900",children:i?"Editar Receta":"Crear Nueva Receta"}),e.jsxs(S,{className:"mb-6 bg-white border border-slate-200 shadow-md rounded-lg",children:[e.jsx(I,{children:e.jsx(E,{className:"text-slate-900",children:"Información General"})}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(p,{htmlFor:"title",className:"text-slate-700",children:"Título"}),e.jsx(f,{id:"title",value:c,onChange:a=>q(a.target.value),placeholder:"Ej: Tarta de Manzana Simple",disabled:n,className:"border-slate-300 focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(p,{htmlFor:"description",className:"text-slate-700",children:"Descripción"}),e.jsx(F,{id:"description",value:T,onChange:a=>A(a.target.value),placeholder:"Una breve descripción de la receta...",disabled:n,className:"border-slate-300 focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(p,{htmlFor:"prepTimeMinutes",className:"text-slate-700",children:"Tiempo Prep. (min)"}),e.jsx(f,{id:"prepTimeMinutes",type:"number",value:g,onChange:a=>_(a.target.value),placeholder:"Ej: 15",disabled:n,min:"0",className:"border-slate-300 focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(p,{htmlFor:"cookTimeMinutes",className:"text-slate-700",children:"Tiempo Cocción (min)"}),e.jsx(f,{id:"cookTimeMinutes",type:"number",value:h,onChange:a=>$(a.target.value),placeholder:"Ej: 30",disabled:n,min:"0",className:"border-slate-300 focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(p,{htmlFor:"servings",className:"text-slate-700",children:"Porciones"}),e.jsx(f,{id:"servings",type:"number",value:b,onChange:a=>z(a.target.value),placeholder:"Ej: 4",disabled:n,min:"1",className:"border-slate-300 focus:ring-emerald-500 focus:border-emerald-500"})]})]})]})})]}),e.jsxs(S,{className:"mb-6 bg-white border border-slate-200 shadow-md rounded-lg",children:[e.jsx(I,{children:e.jsx(E,{className:"text-slate-900",children:"Ingredientes"})}),e.jsx(w,{children:e.jsx(F,{value:B(y),onChange:a=>{D(G(a.target.value))},rows:8,placeholder:`Formato: [Cantidad] [Unidad] [Nombre] (uno por línea)
Ej: 2 tazas Harina
1 Huevo`,disabled:n,className:"border-slate-300 focus:ring-emerald-500 focus:border-emerald-500"})})]}),e.jsxs(S,{className:"mb-6 bg-white border border-slate-200 shadow-md rounded-lg",children:[e.jsx(I,{children:e.jsx(E,{className:"text-slate-900",children:"Instrucciones"})}),e.jsx(w,{children:e.jsx(F,{value:U(x),onChange:a=>{P(O(a.target.value))},rows:10,placeholder:"Escribe cada paso en una nueva línea...",disabled:n,className:"border-slate-300 focus:ring-emerald-500 focus:border-emerald-500"})})]}),L&&e.jsx("p",{className:"text-red-500 text-sm text-center mb-4",children:L}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx(H,{variant:"outline",onClick:()=>v("/app/recipes"),disabled:n,className:"border-slate-300 text-slate-700 hover:bg-slate-50",children:"Cancelar"}),e.jsxs(H,{onClick:J,disabled:n||!c.trim(),className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:[n?e.jsx(X,{className:"mr-2 h-4 w-4 animate-spin"}):null,i?"Actualizar Receta":"Guardar Receta"]})]})]})},ce=()=>e.jsx(Z,{});export{ce as default};
